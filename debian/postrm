#!/bin/sh -e

CONFIGFILE="/etc/alternc/my.cnf"
MENUFILE="/etc/alternc/menulist.txt"

case "$1" in
  remove)
    alternc.install

    rm -f /var/alternc/cgi-bin/mailman /etc/apache{,-ssl}/conf.d/alternc-mailman.conf

    if grep -qs "menu_mailman.php" $MENUFILE; then
	rm -f $MENUFILE.alternc_mailman
	cat $MENUFILE | grep -v "menu_mailman.php" >$MENUFILE.alternc_mailman
        mv -f $MENUFILE.alternc_mailman $MENUFILE
    fi
    ;;
  purge)
    if [ -e "$CONFIGFILE" -a -x "/usr/bin/mysql" ]; then
        . "$CONFIGFILE"
        mysql -f --defaults-file=/etc/alternc/my.cnf -e "DROP TABLE IF EXISTS mailman"
        mysql -f --defaults-file=/etc/alternc/my.cnf -e "DELETE FROM variable WHERE name = 'mailman_url'"
    fi
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.
#DEBHELPER#
